# üìö Documentaci√≥n: Testing ConvNeXtPose Modelos L y M

## √çndice de Documentaci√≥n

Esta es la documentaci√≥n completa para testear los modelos **L (Large)** y **M (Medium)** de ConvNeXtPose en el dataset Human3.6M usando el Protocolo 2.

---

## üìñ Gu√≠as Disponibles

### 1. üöÄ RESUMEN_EJECUTIVO.md
**Para**: Comenzar r√°pidamente  
**Tiempo de lectura**: 5 minutos  
**Contenido**:
- TL;DR con pasos principales
- Comandos de una l√≠nea
- Diferencias clave vs configuraci√≥n actual
- Tips importantes

üëâ **Usa esto si**: Necesitas comenzar YA y tienes experiencia previa

---

### 2. ‚úÖ CHECKLIST_TESTING.md
**Para**: Seguimiento paso a paso interactivo  
**Tiempo de lectura**: 10 minutos  
**Contenido**:
- 10 fases con checkboxes
- Comandos espec√≠ficos para cada paso
- Verificaci√≥n de √©xito
- Troubleshooting r√°pido

üëâ **Usa esto si**: Prefieres una lista de tareas clara y organizada

---

### 3. üìò GUIA_TESTING_MODELOS_L_M.md
**Para**: Gu√≠a completa y detallada  
**Tiempo de lectura**: 30 minutos  
**Contenido**:
- 13 pasos detallados con explicaciones
- Scripts de ejemplo completos
- Troubleshooting extensivo
- An√°lisis avanzado y benchmarking
- Configuraciones arquitect√≥nicas detalladas

üëâ **Usa esto si**: Quieres entender TODO el proceso en profundidad

---

## üõ†Ô∏è Scripts Implementados

### 1. main/config_variants.py
**Prop√≥sito**: Definir configuraciones de arquitectura  
**Funciones principales**:
- `get_model_config(variant)`: Obtiene (depths, dims) para una variante
- `print_model_info(variant)`: Muestra informaci√≥n detallada
- `compare_variants()`: Tabla comparativa de todas las variantes
- `get_recommended_batch_size()`: Recomienda batch size seg√∫n GPU

**Ejemplo de uso**:
```python
from config_variants import get_model_config, print_model_info

# Obtener configuraci√≥n
depths, dims = get_model_config('M')

# Ver info
print_model_info('M')
```

---

### 2. main/test_variants.py
**Prop√≥sito**: Testing de modelos con soporte para variantes  
**Argumentos principales**:
- `--variant`: Variante del modelo (XS, S, M, L)
- `--epoch`: N√∫mero de epoch del checkpoint
- `--gpu`: ID de GPU a usar
- `--protocol`: Protocolo de evaluaci√≥n (1 o 2)
- `--flip_test`: Habilitar flip augmentation
- `--use_gt_bbox`: Usar GT bounding box

**Ejemplo de uso**:
```bash
python test_variants.py --variant M --gpu 0 --epoch 70 --protocol 2 --flip_test
```

---

### 3. main/compare_variants.py
**Prop√≥sito**: Comparar resultados entre variantes  
**Argumentos principales**:
- `--variants`: Variantes a comparar
- `--epoch`: Epoch a analizar
- `--plot`: Generar gr√°ficos
- `--save_report`: Guardar reporte markdown

**Ejemplo de uso**:
```bash
python compare_variants.py --variants M L --epoch 70 --plot --save_report
```

---

### 4. quick_start.sh
**Prop√≥sito**: Script bash interactivo para setup y testing  
**Funciones**:
- Verificaci√≥n autom√°tica de entorno
- Detecci√≥n de GPU y CUDA
- Verificaci√≥n de estructura de datos
- Men√∫ interactivo de comandos
- Ejecuci√≥n guiada

**Ejemplo de uso**:
```bash
bash quick_start.sh
```

---

## üó∫Ô∏è Flujo de Trabajo Recomendado

### Para Principiantes
```
1. RESUMEN_EJECUTIVO.md (entender el objetivo)
   ‚Üì
2. bash quick_start.sh (verificar entorno)
   ‚Üì
3. CHECKLIST_TESTING.md (seguir paso a paso)
   ‚Üì
4. Ejecutar testing con test_variants.py
   ‚Üì
5. Comparar con compare_variants.py
```

### Para Usuarios Avanzados
```
1. RESUMEN_EJECUTIVO.md (comandos r√°pidos)
   ‚Üì
2. test_variants.py directo
   ‚Üì
3. compare_variants.py con --plot --save_report
   ‚Üì
4. GUIA_TESTING_MODELOS_L_M.md (troubleshooting si es necesario)
```

### Para Investigaci√≥n Profunda
```
1. GUIA_TESTING_MODELOS_L_M.md (leer completa)
   ‚Üì
2. Entender configuraciones en config_variants.py
   ‚Üì
3. Experimentar con diferentes configuraciones
   ‚Üì
4. Benchmark avanzado (Paso 12 de la gu√≠a)
   ‚Üì
5. An√°lisis comparativo detallado
```

---

## üéØ Comandos Esenciales

### Setup Inicial
```bash
# 1. Navegar al directorio
cd /home/user/convnextpose_esteban/ConvNeXtPose

# 2. Verificar entorno
bash quick_start.sh

# 3. O manual: instalar dependencias
pip install torch torchvision timm pycocotools opencv-python tqdm numpy matplotlib
```

### Testing
```bash
# Modelo M
cd main
python test_variants.py --variant M --gpu 0 --epoch 70 --protocol 2 --flip_test --use_gt_bbox

# Modelo L
python test_variants.py --variant L --gpu 0 --epoch 70 --protocol 2 --flip_test --use_gt_bbox
```

### Comparaci√≥n
```bash
cd main
python compare_variants.py --variants M L --epoch 70 --protocol 2 --plot --save_report
```

---

## üìä Configuraciones de Modelos

### Resumen R√°pido

| Variante | Depths        | Dims                    | Params | GFLOPs | MPJPE (mm) |
|----------|---------------|-------------------------|--------|--------|------------|
| XS       | [3,3,9,3]     | [48,96,192,384]        | 22M    | 4.5    | ~52        |
| S        | [3,3,27,3]    | [96,192,384,768]       | 50M    | 8.7    | ~48        |
| **M**    | [3,3,27,3]    | [128,256,512,1024]     | 89M    | 15.4   | **44.6**   |
| **L**    | [3,3,27,3]    | [192,384,768,1536]     | 198M   | 34.4   | **42.3**   |

### Diferencias Clave M vs L

**Modelo M (Medium)**:
- Depths: `[3, 3, 27, 3]`
- Dims: `[128, 256, 512, 1024]`
- Balance √≥ptimo precisi√≥n/velocidad
- Recomendado para prototipado

**Modelo L (Large)**:
- Depths: `[3, 3, 27, 3]`
- Dims: `[192, 384, 768, 1536]`
- M√°xima precisi√≥n
- Recomendado para resultados finales

---

## üîç Estructura de Archivos

### Archivos de Documentaci√≥n
```
ConvNeXtPose/
‚îú‚îÄ‚îÄ README_TESTING.md              # ‚Üê Este archivo (√≠ndice)
‚îú‚îÄ‚îÄ RESUMEN_EJECUTIVO.md           # Vista r√°pida
‚îú‚îÄ‚îÄ CHECKLIST_TESTING.md           # Checklist paso a paso
‚îú‚îÄ‚îÄ GUIA_TESTING_MODELOS_L_M.md    # Gu√≠a completa
‚îî‚îÄ‚îÄ quick_start.sh                 # Script bash interactivo
```

### Scripts de Testing
```
ConvNeXtPose/main/
‚îú‚îÄ‚îÄ config_variants.py             # Configuraciones de variantes
‚îú‚îÄ‚îÄ test_variants.py               # Testing adaptado
‚îî‚îÄ‚îÄ compare_variants.py            # Comparaci√≥n de resultados
```

### Archivos de Entrada
```
ConvNeXtPose/
‚îú‚îÄ‚îÄ data/Human36M/                 # Dataset
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ annotations/
‚îÇ   ‚îî‚îÄ‚îÄ bbox_root/
‚îî‚îÄ‚îÄ output/model_dump/             # Checkpoints
    ‚îî‚îÄ‚îÄ snapshot_70.pth.tar
```

### Archivos de Salida
```
ConvNeXtPose/output/
‚îú‚îÄ‚îÄ result/
‚îÇ   ‚îú‚îÄ‚îÄ bbox_root_pose_human36m_output.json  # Predicciones
‚îÇ   ‚îú‚îÄ‚îÄ results_M_epoch70.json               # M√©tricas M
‚îÇ   ‚îú‚îÄ‚îÄ results_L_epoch70.json               # M√©tricas L
‚îÇ   ‚îú‚îÄ‚îÄ comparison_plot.png                  # Gr√°fico comparativo
‚îÇ   ‚îî‚îÄ‚îÄ comparison_report.md                 # Reporte
‚îî‚îÄ‚îÄ log/                                      # Logs de ejecuci√≥n
```

---

## ‚öôÔ∏è Configuraci√≥n del Protocolo 2

### Diferencias Protocol 1 vs 2

**Protocol 1 (PA-MPJPE)**:
- Training: S1, S5, S6, S7, S8, S9
- Testing: **S11**
- M√©trica: PA-MPJPE (con alineaci√≥n Procrustes)
- M√°s f√°cil (~2-3mm mejor)

**Protocol 2 (MPJPE)** ‚Üê **Usamos este**:
- Training: S1, S5, S6, S7, S8
- Testing: **S9, S11**
- M√©trica: MPJPE (sin alineaci√≥n)
- M√°s estricto (posici√≥n absoluta)

### Verificar Protocolo

```bash
grep "self.protocol" data/Human36M/Human36M.py
# Debe mostrar: self.protocol = 2
```

Si muestra `self.protocol = 1`, cambiar a 2:
```python
# data/Human36M/Human36M.py l√≠nea ~30
self.protocol = 2
```

---

## üéì Resultados Esperados

### Protocol 2 (MPJPE)

**Modelo M**:
- Total: **44.6 mm**
- Rango aceptable: 43-46 mm
- Mejor acci√≥n: Directions (~39.8 mm)
- Peor acci√≥n: Greeting (~46.9 mm)

**Modelo L**:
- Total: **42.3 mm**
- Rango aceptable: 41-44 mm
- Mejor acci√≥n: Directions (~37.9 mm)
- Peor acci√≥n: Greeting (~44.5 mm)

**Mejora L vs M**: ~2.3 mm (~5.2%)

---

## üêõ Troubleshooting R√°pido

### Problema: Out of Memory
**Soluci√≥n**: Reducir batch size
```bash
python test_variants.py --variant L --gpu 0 --epoch 70 --batch_size 8
```

### Problema: Modelo no carga
**Soluci√≥n**: Verificar nombre del checkpoint
```bash
# Debe ser: snapshot_70.pth.tar
ls -la output/model_dump/
mv output/model_dump/OLD_NAME.pth output/model_dump/snapshot_70.pth.tar
```

### Problema: Dataset no encontrado
**Soluci√≥n**: Verificar estructura
```bash
ls data/Human36M/images/ | wc -l  # Debe ser > 0
ls data/Human36M/annotations/*.json
```

### Problema: Resultados muy diferentes al paper
**Causas posibles**:
1. Protocolo incorrecto (verificar que sea 2)
2. Checkpoint no corresponde a la variante
3. Configuraci√≥n de bbox incorrecta
4. Datos incompletos o corruptos

---

## üìû Pr√≥ximos Pasos

### 1. Preparaci√≥n
- [ ] Leer RESUMEN_EJECUTIVO.md
- [ ] Ejecutar `bash quick_start.sh`
- [ ] Verificar que todo est√° listo

### 2. Testing
- [ ] Testear Modelo M
- [ ] Testear Modelo L
- [ ] Verificar resultados

### 3. An√°lisis
- [ ] Comparar M vs L
- [ ] Generar gr√°ficos
- [ ] Crear reporte

### 4. Validaci√≥n
- [ ] Verificar que MPJPE est√° en rango esperado
- [ ] Confirmar que L > M en precisi√≥n
- [ ] Documentar hallazgos

---

## üåü Recursos Adicionales

### Paper Original
- **T√≠tulo**: ConvNeXtPose: A Fast Accurate Method for 3D Human Pose Estimation
- **Journal**: IEEE Access 2023
- **Link**: https://ieeexplore.ieee.org/document/10288440

### Repositorio Oficial
- **GitHub**: https://github.com/medialab-ku/ConvNeXtPose
- **Modelos**: https://drive.google.com/drive/folders/12H7zkLvmJtrkCmAUAPkQ6788WAnO60gI

### Dataset Human3.6M
- **Website**: http://vision.imar.ro/human3.6m/
- **Descripci√≥n**: Dataset de pose 3D m√°s grande
- **Sujetos**: 11 actores, 15 acciones

---

## üìß Soporte

Si tienes problemas:

1. **Primero**: Consulta la secci√≥n de troubleshooting en cada gu√≠a
2. **Segundo**: Ejecuta `bash quick_start.sh` para diagn√≥stico
3. **Tercero**: Revisa logs en `output/log/`
4. **Cuarto**: Verifica que seguiste todos los pasos del checklist

---

## ‚úÖ Checklist de Inicio R√°pido

Antes de empezar, verifica:

- [ ] Python 3.8+ instalado
- [ ] PyTorch con CUDA funcionando
- [ ] GPU con ‚â•8GB VRAM (o ‚â•4GB para M solo)
- [ ] Dataset Human3.6M descargado
- [ ] Modelos pre-entrenados descargados
- [ ] Scripts de testing creados (config_variants.py, test_variants.py, compare_variants.py)
- [ ] Protocolo configurado a 2

Si todos est√°n ‚úÖ, est√°s listo para comenzar:

```bash
bash quick_start.sh
```

---

**√öltima actualizaci√≥n**: Octubre 2025  
**Versi√≥n**: 1.0  
**Mantenedor**: Testing adaptado para modelos L y M

---

## üöÄ ¬°Comienza Ahora!

### Opci√≥n 1: Guiado (Recomendado)
```bash
bash quick_start.sh
```

### Opci√≥n 2: Manual R√°pido
```bash
cd main
python test_variants.py --variant M --gpu 0 --epoch 70 --protocol 2 --flip_test
python test_variants.py --variant L --gpu 0 --epoch 70 --protocol 2 --flip_test
python compare_variants.py --variants M L --epoch 70 --plot --save_report
```

### Opci√≥n 3: Explorar Documentaci√≥n
1. Lee `RESUMEN_EJECUTIVO.md` para vista general
2. Sigue `CHECKLIST_TESTING.md` paso a paso
3. Consulta `GUIA_TESTING_MODELOS_L_M.md` para detalles

---

**¬°√âxito en tu testing!** üéâ
